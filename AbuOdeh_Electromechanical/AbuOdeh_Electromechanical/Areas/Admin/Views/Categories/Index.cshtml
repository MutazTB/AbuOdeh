@using AbuOdeh_Electromechanical.Resources;
@using Microsoft.AspNetCore.Mvc.Localization;
@inject IHtmlLocalizer<LocalizationResources> _htmlLocalizer;
@model List<AbuOdeh_Electromechanical.Repository.Entities.Category>

<link rel="shortcut icon" href="~/assets/images/logo/favicon.png">
<link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
<script src="~/sweetalert2/sweetalert2.all.min.js" defer></script>
<script src="~/admin/assets/js/app.min.js"></script>
<link href="~/admin/assets/vendors/datatables/datatables.bootstrap.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="~/admin/assets/vendors/datatables/jquery.dataTables.min.js"></script>
<script src="~/admin/assets/vendors/datatables/dataTables.bootstrap.min.js"></script>

<div class="page-container">
    <div class="main-content">
        <div class="card">
            <div class="card-body">
                <div class="form-group text-right">
                    <a href="Categories/Create" class="btn btn-primary">@_htmlLocalizer.GetString("AddNewCategory")</a>
                </div>
                <div class="m-t-25">
                    <table id="CategoryTable" class="table table-bordered">
                        <thead>
                            <tr>
                                <th class="col-1">#</th>
                                <th class="col-4"><div style="display: flex;justify-content: center;">@_htmlLocalizer.GetString("NameEn")</th>
                                <th class="col-4"><div style="display: flex;justify-content: center;">@_htmlLocalizer.GetString("NameAr")</th>
                                <th class="col-3"><div style="display: flex;justify-content: center;">@_htmlLocalizer.GetString("Actions")</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (int i = 0; i < Model.Count; i++)
                            {
                                int x = i + 1;
                                <tr>
                                    <td class="col-1">@x</td>
                                    <td class="col-4">@Model[i].NameEn</td>
                                    <td class="col-4">@Model[i].NameAr</td>
                                    <td class="col-3">
                                        <div style="display: flex;justify-content: space-evenly;">
                                            <a class="cursor-pointer" data-id="@Model[i].ObjectKey" onclick="deleteCategory('@Model[i].ObjectKey')" title="@_htmlLocalizer.GetString("Delete")">
                                                <i class="far fa-trash-alt"></i>
                                            </a>
                                            <a class="cursor-pointer" href="/Admin/Categories/Update/@Model[i].ObjectKey" title="@_htmlLocalizer.GetString("Edit")">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $("#CategoryTable").DataTable();
    });

    function deleteCategory(objectKey) {
        console.log(objectKey);
        Swal.fire({
            title: 'Are you sure?',
            text: "Do you really want to delete this item?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: '/Admin/Categories/Delete/' + objectKey,
                    type: 'DELETE',
                    contentType: 'application/json',
                    data: JSON.stringify({ objectKey: objectKey }),
                    success: function (response) {
                        Swal.fire(
                            'Deleted!',
                            'The item has been deleted.',
                            'success'
                        ).then(() => {
                            location.reload();
                        });
                    },
                    error: function (xhr, status, error) {
                        Swal.fire(
                            'Error!',
                            'Failed to delete the item.',
                            'error'
                        );
                    }
                });
            }
        });
    };
</script>